<template>
  <div id="contact">
    <div class="-svg-logo">
      <svg viewBox="0 0 408 396.5">
        <g class="-svg-rings">
          <path class="-svg-ring" fill="#070606"
                d="M106.102,36.051c0.406,0.423,0.895,0.904,1.318,1.338   c28.505-17.16,61.484-27.093,95.085-27.407C252.161,9.17,302.102,28.833,337.84,64.12c14.759,14.498,26.82,31.549,36.1,50.018   c0.306-0.05,0.628-0.114,0.935-0.183c-9.163-18.743-21.146-36.114-35.933-50.937C303.676,26.783,253.646,5.067,202.504,4.595   c-35.164-0.551-70.39,9.082-100.96,26.881C102.991,32.922,104.382,34.299,106.102,36.051"></path>
          <path class="-svg-ring" id="ring-3_1_" fill="#070606"
                d="M81.724,354.239c1.896-1.927,3.894-3.995,6.03-6.241   c-6.259-4.953-12.328-10.157-17.908-15.885c-34.742-34.873-54.583-83.645-54.174-132.659   c-0.384-48.997,19.443-97.778,54.202-132.642c0.278-0.286,0.611-0.551,0.896-0.837c-0.462-4.04-0.769-7.792-1.002-11.344   c-2.12,1.914-4.35,3.688-6.398,5.705C26.592,96.476,5.036,147.667,4.997,199.455c0.075,51.792,21.596,102.969,58.402,139.124   C69.128,344.241,75.325,349.376,81.724,354.239"></path>
          <path class="-svg-ring" id="ring-2_1_" fill="#070606"
                d="M385.104,141.042c6.141,18.812,9.536,38.55,9.563,58.413   c0.188-19.85-2.998-39.64-8.962-58.574C385.511,140.938,385.294,140.991,385.104,141.042"></path>
          <path class="-svg-ring" id="ring-1_1_" fill="#070606"
                d="M202.504,388.963c-28.928-0.274-57.372-7.707-82.952-20.675   c-2.008,1.774-4.161,3.596-6.386,5.479c27.727,13.729,58.563,21.013,89.338,20.521c51.131-0.465,101.155-22.184,136.437-58.402   c35.728-35.824,56.172-86.042,55.737-136.432c-0.089,50.403-21.034,100.162-56.839,135.345   C302.113,370.112,252.161,389.763,202.504,388.963"></path>
        </g>
        <path class="-svg-bird" id="bird-path_1_" fill="#070606"
              d="M401.534,123.121c-0.006-0.058-13.413,2.672-23.021,5.073   c-11.384,2.846-43.403,14.868-43.428,14.814c-0.023-0.053,32.089-11.862,43.428-14.814   C388.078,125.705,401.565,123.155,401.534,123.121c-0.103-0.11-0.411-0.517-0.555-0.582c-0.471-0.213-1.109-0.213-1.578-0.213   c-6.258,0-34.77,4.588-58.258,12.142c-1.523,0.479-2.714,0.715-3.648,0.715c-1.819,0-2.538-0.862-3.944-2.804   c-1.714-2.348-4.066-5.569-10.369-8.267c-2.598-1.116-5.619-1.68-8.975-1.68c-13.184,0-29.852,8.638-39.643,20.542   c-0.05,0.064-0.1,0.075-0.1,0.075c-0.846,0-3.795-3.302-8.885-15.822c-3.728-9.146-7.543-20.75-9.746-29.531   c-3.301-13.186-12.862-31.721-19.209-43.98c-2.704-5.229-4.841-9.368-5.381-10.98c-0.396-1.236-1.063-1.875-1.93-1.875   c-0.551,0-1.103,0.287-1.642,0.852c-6.181,6.476-18.803,60.535-18.014,77.113c0.64,13.622,11.394,22.822,16.567,27.254   c0.601,0.525,1.257,1.074,1.77,1.55c-2.755-0.988-8.502-5.691-16.145-11.944c-11.021-9.018-27.677-22.639-50.219-37.526   c-31.61-20.859-51.849-41.516-63.932-53.882c-8.061-8.217-11.416-11.561-13.797-11.561c-0.539,0-1.563,0.211-2.103,1.627   c-2.715,7.231,0.707,82.017,34.386,122.442c18.803,22.576,42.796,34.169,58.668,41.835c9.141,4.417,16.361,7.9,17.486,11.176   c0.244,0.749,0.194,1.46-0.217,2.248c-1.498,3.015-4.111,6.667-7.427,11.321c-9.113,12.784-22.887,32.104-32.973,64.316   c-4.534,14.47-51.92,65.155-64.238,77.478c-0.601,0.608-14.698,14.759-13.045,18.758c0.139,0.329,0.579,1.063,1.78,1.063   c2.942,0,10.714-5.043,23.093-15.02c16.205-13.058,27.265-23.978,35.359-31.947c7.861-7.769,12.774-12.62,16.156-13.146   c-0.312,1.664-1.28,5.914-4.25,16.634c-0.066,0.265-0.206,0.866,0.128,1.313l0.316,0.537h0.473c0.718,0,1.09-0.583,4.2-4.449   c9.502-11.781,38.419-47.817,78.585-55.711c23.543-4.625,52.756-26.453,63.074-59.222c15.615-49.573,28.673-80.747,97.556-96.54   c9.33-2.137,10.603-2.892,10.712-3.652C401.643,123.65,401.549,123.254,401.534,123.121z"></path>
      </svg>
    </div>
    <div class="_flex_v" id="container">
      <div class="contact-list">
        <div class="-contact-item"><span class="-contact-info">Phone</span><span
          class="-contact-title">: +640212731902</span></div>
        <div class="-contact-item"><span class="-contact-info">Email</span><span class="-contact-title">: support@nectarbeverages.co.nz</span>
        </div>
      </div>
      <form class="cmxform" id="commentForm" action="" target="frame">
        <div class="-cover _flex_v_h"><h3>Your order has been submitted</h3>
          <p>Check out more about Nectar</p>
          <router-link class="-btn" to="/about">About Nectar</router-link>
        </div>
        <fieldset>
          <div class="form-legend">Enter your contact details below and we'll can back in touch with you. Other-wise get
            in touch with us via phone or email.
          </div>
          <p><label for="name">Name:<span>(required, at least 2 characters)</span></label><input id="name-input"
                                                                                                 name="name"
                                                                                                 minlength="2"
                                                                                                 type="text"
                                                                                                 required=""></p>
          <p><label for="phone">E-Mail:<span>(required)</span></label><input id="email-input" type="email" name="email"
                                                                             required=""></p>
          <p><label for="email">Phone:</label><input id="phone-input" type="phone" name="phone"></p>
          <p><label for="message">Your order:<span>(required)</span></label><textarea id="message-input" name="message"
                                                                                      required=""></textarea></p>
          <p><input class="-btn btn" id="send" type="submit" value="Send" @click="click_send"></p></fieldset>
      </form>
    </div>
  </div>
</template>

<script>
  /* eslint-disable no-undef,one-var */

  import $ from 'jquery'
  export default {
    name: 'Contact',
    metaInfo: {
      title: 'Contact the Team at Nectar.',
      meta: [
        {
          name: 'description',
          content: 'Nectar\'s fresh, delicious and natural Tea beverages supplied right to your store. Get in touch with us.'
        }
      ]
    },
    methods: {
      click_send (e) {
        e.preventDefault()
        let $form = $('form'),
          message = $('#message-input').val(),
          name = $('#name-input').val(),
          phone = $('#phone-input').val(),
          email = $('#email-input').val()

        $form.validate().form()
        this.clickSound.play()
        if ($form.valid()) {
          let data = {
            'phone': phone,
            'email': email,
            'name': name,
            'message': message
          }
          this.animate_contact_logo($form)
          this.contact_ajax(data, $form)
        } else {
          this.errorSound.play()
          $('.form-legend').text('Darn... You seem to have entered some details incorrectly. ' +
            'That\'s ok, just adjust the details and hit send!')
            .addClass('__error')
        }
      },
      animate_contact_end ($form, success) {
        let $elm = $('.-svg-logo'),
          $rings = $elm.find('.-svg-rings'),
          $bird = $elm.find('.-svg-bird'),
          dur = 0.3

        this.contacting_animation = new TimelineMax({delay: success ? 1 : 0})
          .call(($this) => {
            $this[success ? 'successSound' : 'errorSound'].play()
          }, [this])
          .to([$rings, $bird], dur, {scale: 1, transformOrigin: '50% 50%', rotation: 0}, '-=' + (dur / 1.5))
          .fromTo($form.children('.-cover'), 0.3, {left: '100%'}, {left: !success ? '100%' : 0})
      },
      animate_contact_logo () {
        let $elm = $('.-svg-logo'),
          $rings = $elm.find('.-svg-rings'),
          $bird = $elm.find('.-svg-bird'),
          dur = 0.3

        this.contacting_animation = new TimelineMax()
          .to($(window), 0.3, {scrollTo: {y: 0}})
          .to($bird, dur, {scale: 0.75, transformOrigin: '50% 50%'})
          .fromTo($rings, dur, {rotation: 0}, {
            rotation: -360,
            repeat: -1,
            transformOrigin: '50% 50%'
          }, '-=' + (dur / 1.5))
      },
      contact_ajax (data, $form) {
        data = JSON.stringify(data)
        return new Promise((resolve, reject) => {
          let api = process.env.NODE_ENV === 'development' ? 'http://localhost:9000' : '/.netlify/functions'
          fetch(api + '/contact-sendgrid', {
            method: 'POST',
            body: data
          }).then(response => {
            resolve(response)
            this.animate_contact_end($form, true)
          }).catch(err => {
            reject(err)
            this.animate_contact_end($form, false)
            $('.form-legend').text('Darn... There seem\'s to be some funky technical issues, ' +
              'feel free to try again or contact us directly via Email or Phone')
              .addClass('__error')
          })
        })
      }
    }
  }
</script>

<style lang="scss" scoped>

</style>
